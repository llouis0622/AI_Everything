# 1. 운영체제 개요

## 1. 운영체제의 역할

### 개요

- 커널 : 운영체제의 핵심 기능을 담당하는 부분
- 자원 : 프로그램 실행에 마땅히 필요한 요소

### CPU 관리 : CPU 스케줄링

- 실행 중인 모든 프로그램들이 공정하고 합리적으로 CPU를 할당받도록 CPU의 할당 순서와 사용 시간 결정

### 메모리 관리 : 가상 메모리

- 실제 물리적인 메모리 크기보다 더 큰 메모리를 이용할 수 있도록 하는 기술

### 파일/디렉터리 관리 : 파일 시스템

- 보조기억장치 내의 정보를 파일 및 폴더 단위로 접근/관리할 수 있도록 만드는 운영체제 내부 프로그램

### 프로세스 및 스레드 관리

- 프로세스 : 실행 중인 프로그램
- 스레드 : 프로세스를 이루는 실행 단위
- 프로세스와 스레드가 올바르게 처리되도록 실행의 순서를 제어하고 자원을 적절하게 배분

## 2. 시스템 콜과 이중 모드

- 커널 영역 : 사용자 프로그램이 아닌 운영체제가 적재되는 메모리 공간
- 사용자 영역 : 운영체제가 적재되는 커널 영역 외에 사용자 응용 프로그램이 적재되는 공간
- 시스템 콜 : 운영체제의 서비스를 제공 받기 위한 수단, 호출 가능한 함수 형태
- 부모 프로세스 : 새 프로세스를 생성한 프로세스
- 자식 프로세스 : 부모 프로세스에 의해 생성된 프로세스
- 소프트웨어 인터럽트 : 명령어에 의해 발생하는 인터럽트, 자원에 접근하는 입출력 명령어
- 사용자 영역 실행 중 시스템 콜 호출 → 현재 수행 중인 작업 백업 → 커널 영역 내의 인터럽트를 처리하기 위한 코드 실행 → 다시 사용자 영역 코드 실행
- 사용자 모드
    - 사용자 영역에 적재된 코드를 실행할 때의 실행 모드
    - 운영체제 서비스를 제공받을 수 없는 실행 모드
- 커널 모드
    - 커널 영역에 적재된 코드를 실행할 때의 실행 모드
    - 운영체제 서비스를 제공받을 수 있는 실행 모드
- 이중 모드 : 사용자 모드, 커널 모드 2개의 모드로 구분하여 실행하는 것

# 2. 프로세스와 스레드

## 1. 프로세스

### 개요

- 포그라운드 프로세스 : 사용자가 보는 공간에서 사용자와 상호작용하며 실행
- 백그라운드 프로세스 : 사용자가 보지 못하는 곳에서 실행
- 데몬(서비스) : 백그라운드 프로세스 중 사용자와 별다른 상호작용 없이 주어진 작업만 수행하는 특별한 백그라운드 프로세스
- 코드 영역(텍스트 영역)
    - 실행 가능한 명령어가 저장되는 공간
    - CPU가 읽고 실행할 명령어 보관 → 읽기 전용 공간
- 데이터 영역
    - 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간
    - 정적 변수, 전역 변수 → 초기값이 있는 데이터
- BSS 영역
    - 프로그램을 사용하는 동안 유지할 데이터 중 초기값이 없는 데이터가 저장되는 공간
- 힙 영역
    - 프로그램을 만드는 사용자가 직접 할당 가능한 저장 공간
    - 프로그램 실행 도중 비교적 자유롭게 할당하여 사용 가능한 메모리 공간
    - 메모리 누수 : 메모리 공간 미반환 시 할당한 공간이 계속 메모리 내에 남아 메모리를 낭비하는 것
- 스택 영역
    - 데이터 영역에 담기는 값과는 달리 일시적으로 사용할 값들이 저장되는 공간
    - 매개변수, 지역 변수, 함수 복귀 주소
    - 스택 트레이스 형태의 함수 호출 정보 저장 가능
    - 스택 트레이스 : 특정 시점에 스택 영역에 저장된 함수 호출 정보

### PCB와 문맥 교환

- 프로세스 제어 블록(PCB)
    - 프로세스와 관련한 다양한 정보를 내포하는 구조체의 일종
    - 새로운 프로세스가 메모리에 적재됐을 때 커널 영역에 만들어지고, 프로세스의 실행이 끝나면 폐기
- PCB에 담기는 정보
    - 프로세스 ID(PID) : 프로세스 식별 번호
    - 프로세스가 실행 과정에서 사용한 레지스터 값
    - 프로세스 상태 : 프로세스가 현재 어떤 상태인지를 나타냄
    - CPU 스케줄링 정보 : 프로세스가 언제, 어떤 순서로 CPU를 할당받을지 나타냄
    - 메모리 관련 정보 : 프로세스의 메모리상 적재 위치 확인
    - 프로세스가 사용한 파일 및 입출력장치 관련 정보
- 프로세스 테이블 : 실행 중인 PCB의 모음
- 프로세스 실행 : 운영체제에 의해 CPU의 자원을 할당받음
- 타이머 인터럽트(타임아웃 인터럽트) : 시간이 끝났음을 알리는 인터럽트
- 프로세스는 자신의 차례가 되면 정해진 시간만큼 CPU 사용 → 타이머 인터럽트 발생 시 자신의 차례 양보 후 다음 차례가 올 때까지 대기
- 문맥 : 백업 대상이 되는 중간 정보, 프로세스의 수행을 재개하기 위해 기억해야 할 정보
- 프로세스가 CPU 사용 시간이 다 되거나 인터럽트 발생 → 운영체제는 해당 프로세스의 PCB에 문맥 백업 → 실행할 프로세스의 문맥 복구
- 문맥 교환 : 기존 프로세스의 문맥을 PCB에 백업하고, PCB에서 문맥을 복구하여 새로운 프로세스를 실행하는 것
- 프로세스 간 잦은 문맥 교환 → 캐시 미스 발생 가능성 증가 → 큰 오버헤드 발생

### 프로세스의 상태

- 생성 상태(new)
    - 프로세스를 생성 중인 상태
    - 메모리에 적재되어 PCB를 할당받은 상태
    - 실행 준비가 완료된 프로세스는 준비 상태가 되어 CPU 할당 대기
- 준비 상태(ready)
    - CPU를 할당받아 실행할 수 있지만, 자신의 차례가 아니라 기다리고 있는 상태
    - 준비 상태인 프로세스가 CPU를 할당받으면 실행 상태가 됨
    - 디스패치 : 준비 상태인 프로세스가 실행 상태로 전환되는 것
- 실행 상태(running)
    - CPU를 할당받아 실행 중인 상태
    - 일정 시간 동안만 CPU를 사용할 수 있음
    - 타이머 인터럽트 발생 → 프로세스가 할당된 시간 모두 사용 → 준비 상태 전환
    - 실행 도중 입출력장치 사용 → 입출력장치 작업 종료까지 대기 → 대기 상태 전환
- 대기 상태(blocked)
    - 곧장 실행이 불가능한 조건에 놓이는 경우
    - 입출력 작업 요청, 바로 확보할 수 없는 자원 요청
    - 실행 가능한 상태 → 준비 상태 → CPU 할당 대기
- 종료 상태(terminated)
    - 프로세스가 종료된 상태
    - 운영체제는 PCB와 프로세스가 사용한 메모리 정리
- 블로킹 입출력 : 프로세스가 실행 도중 입출력 작업 수행 시 대기 상태로 전환 후, 입출력 작업 완료 시 준비 상태가 되어 실행 재개
- 논블로킹 입출력 : 입출력장치에게 입출력 작업을 맡긴 뒤, 곧바로 이어질 명령어 실행하는 것

## 2. 멀티프로세스와 멀티스레드

- 멀티프로세스
    - 동시에 여러 프로세스가 실행되는 것
    - 자원을 공우하지 않고, 독립적으로 실행
    - 한 프로세스에 문제가 생겨도 다른 프로세스에는 지장이 없거나 적음
- 멀티스레드
    - 프로세스를 동시에 실행하는 여러 스레드
    - 프로세스 자원 공유
    - 한 스레드에 생긴 문제가 프로세스 전체 문제가 될 수 있음

## 3. 프로세스 간 통신

### 개요

- 프로세스 간 통신(IPC) : 프로세스 간에도 자원을 공유하고 데이터를 주고 받을 수 있는 방법
    - 공유 메모리 : 데이터를 주고받는 프로세스가 공통적으로 사용할 메모리 영역을 두는 방식
    - 메시지 전달 : 프로세스 간에 주고받을 데이터를 메시지의 형태로 주고받는 방식

### 공유 메모리

- 프로세스 간에 공유하는 메모리 영역을 토대로 데이터를 주고받는 통신 방식
- 특정 프로세스가 다른 프로세스의 메모리 공간을 임의로 수정할 수 없음
- 공유 메모리 할당 → 프로세스가 해당 메모리 공간 공유 및 읽고 쓰기 가능
- 통신을 주고받는 각 프로세스가 마치 자신의 메모리 영역을 읽고 쓰는 것처럼 통신

### 메시지 전달

- 프로세스 간에 주고받을 데이터가 커널을 거쳐 송수신되는 통신 방식
- 메시지를 보내는 수단과 받는 수단이 명확하게 구분
- 주고받는 데이터가 커널을 통해 송수신 → 공유 메모리 기반 IPC보다 통신 속도 느림
- 파이프 : 단방향 프로세스 간 통신 도구
    - 익명 파이프 : 단방향 통신 수단인 전통적인 파이트
    - 지명 파이프 : 익명 파이프를 확장한 파이프, 양방향 통신 지원
- 시그널 : 프로세스에게 특정 이벤트가 발생했음을 알리는 비동기적인 신호
- 시그널 발생 → 하던 일 잠시 중단 → 시그널 처리를 위한 시그널 핸들러 실행 → 실행 재개
- 원격 프로시저 호출(RPC) : 원격 코드를 실행하는 IPC 기술
- 네트워크 소켓을 통한 IPC 수행
